# Sentinel Release & Auto-Update Setup

## Quick Reference: All GitHub Secrets

| Secret | Value | How to Get |
|--------|-------|------------|
| `TAURI_SIGNING_PRIVATE_KEY` | (see below) | Already generated |
| `TAURI_SIGNING_PRIVATE_KEY_PASSWORD` | `sentinel-update-2025` | Already set |
| `APPLE_CERTIFICATE` | Base64 .p12 | Export from Keychain Access |
| `APPLE_CERTIFICATE_PASSWORD` | Your .p12 password | Set when exporting |
| `APPLE_SIGNING_IDENTITY` | `Developer ID Application: Name (ID)` | Keychain Access or `security find-identity` |
| `APPLE_ID` | Your email | Apple Developer account email |
| `APPLE_PASSWORD` | `xxxx-xxxx-xxxx-xxxx` | https://appleid.apple.com → App-Specific Passwords |
| `APPLE_TEAM_ID` | `XXXXXXXXXX` | https://developer.apple.com/account → Membership |

---

## Signing Keys

**Location:** `~/.tauri/`
- Private key: `~/.tauri/sentinel.key`
- Public key: `~/.tauri/sentinel.pub`
- Password: `sentinel-update-2025`

**Public Key (in tauri.conf.json):**
```
RWR2kmM0j3kdEE40qVMpjo4M4m05VaGVzKfJEjgsRbz/f5BI91WLHkVt
```

---

## GitHub Secrets

Add these at: https://github.com/lilfourn/Sentinal/settings/secrets/actions

### Required for Auto-Updates

#### `TAURI_SIGNING_PRIVATE_KEY`
```
untrusted comment: minisign encrypted secret key
RWQAAEIyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdpJjNI95HRBW1NmhebXjm0lHdGYftj+TCwS8BMZ/Einlf50uKr/elk40qVMpjo4M4m05VaGVzKfJEjgsRbz/f5BI91WLHkVtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
```

#### `TAURI_SIGNING_PRIVATE_KEY_PASSWORD`
```
sentinel-update-2025
```

### macOS Code Signing (Required for Distribution)

Without these, users will see "unidentified developer" warning and need to bypass Gatekeeper.

#### `APPLE_CERTIFICATE`

Export your Developer ID certificate as base64:

1. Open **Keychain Access** → *login* → *My Certificates*
2. Find `Developer ID Application: Your Name (XXXXXXXXXX)`
3. Expand it, right-click the **private key** → *Export*
4. Save as `.p12` file with a password
5. Convert to base64:
   ```bash
   base64 -i certificate.p12 -o certificate-base64.txt
   ```
6. Copy contents of `certificate-base64.txt` as the secret value

#### `APPLE_CERTIFICATE_PASSWORD`

The password you set when exporting the `.p12` file.

#### `APPLE_SIGNING_IDENTITY`

The full certificate name from Keychain Access, e.g.:
```
Developer ID Application: Your Name (XXXXXXXXXX)
```

Or just run:
```bash
security find-identity -v -p codesigning
```

#### `APPLE_ID`

Your Apple Developer account email address.

#### `APPLE_PASSWORD`

An **app-specific password** (not your Apple ID password):

1. Go to https://appleid.apple.com
2. Sign in → *App-Specific Passwords*
3. Click **+** to generate a new password
4. Name it "Sentinel CI" or similar
5. Copy the generated password (format: `xxxx-xxxx-xxxx-xxxx`)

#### `APPLE_TEAM_ID`

Your 10-character Team ID:

1. Go to https://developer.apple.com/account
2. Look in the top-right or go to *Membership Details*
3. Copy your **Team ID** (e.g., `ABCDE12345`)

---

## Release Workflow

### 1. Bump Version
```bash
./scripts/bump-version.sh 0.2.0
```

### 2. Commit & Tag
```bash
git add -A
git commit -m "chore: release v0.2.0"
git tag v0.2.0
```

### 3. Push
```bash
git push && git push --tags
```

### 4. Monitor Build
GitHub Actions will automatically:
- Build for macOS (arm64 + x64), Windows, Linux
- Sign binaries with your private key
- Create a draft release with all artifacts
- Publish the release when all builds complete

### 5. Verify
- Check https://github.com/lilfourn/Sentinal/releases
- Download and test on each platform
- Users with existing installs will see update notification

---

## Update Endpoint

The app checks for updates at:
```
https://github.com/lilfourn/Sentinal/releases/latest/download/latest.json
```

This file is automatically generated by `tauri-action` during the build.

---

## Troubleshooting

### Update check fails
- Verify `latest.json` exists in the latest release
- Check CSP allows `github.com` connections (already configured)

### Signature verification fails
- Ensure `TAURI_SIGNING_PRIVATE_KEY` matches the pubkey in `tauri.conf.json`
- Password must match exactly

### macOS "unidentified developer" warning
- Add Apple signing secrets to enable notarization
- Without signing, users must right-click > Open to bypass Gatekeeper
